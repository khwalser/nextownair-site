<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Alpena Flight Schedule - NexTownAir</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
</head>
<body>
  <h1>Alpena (APN) to Detroit (DTW) Flight Schedule</h1>
  <p id="flight-status">Loading flight data...</p>

  <table border="1" cellpadding="6" cellspacing="0">
   <thead>
  <tr>
    <th>Flight</th>
    <th>From</th>
    <th>To</th>
    <th>Departs</th>
    <th>Arrives</th>
    <th>Price (from)</th>
    <th>Book</th>
  </tr>
</thead>

    <tbody id="flight-table-body"></tbody>
  </table>

  <p>
    <a href="index.html">‚Üê Back to NextTownAir home</a>
  </p>

 <script>
  function formatDateTime(isoString) {
    if (!isoString) return '';

    const d = new Date(isoString);

    const day = d.toLocaleDateString('en-US', { weekday: 'short' });
    const time = d.toLocaleTimeString('en-US', {
      hour: 'numeric',
      minute: '2-digit'
    });

    return day + ' ' + time;
  }

  function formatPrice(from, currency) {
    if (from == null) return 'See options';
    const rounded = Math.round(from);
    const symbol = currency === 'USD' ? '$' : '';
    return `${symbol}${rounded}`;
  }

  async function loadFlightData() {
    const statusEl = document.getElementById('flight-status');
    const tbody = document.getElementById('flight-table-body');

    statusEl.textContent = 'Loading flight data...';

    try {
      const response = await fetch(
        'https://transcendent-selkie-15860a.netlify.app/.netlify/functions/flight-proxy'
      );

      if (!response.ok) {
        throw new Error('HTTP ' + response.status);
      }

      const flights = await response.json();
      statusEl.textContent = '';

      tbody.innerHTML = '';

      flights.forEach(f => {
        const row = document.createElement('tr');

        const dep = formatDateTime(f.departureTime);
        const arr = formatDateTime(f.arrivalTime);
        const priceText = formatPrice(f.priceFrom, f.currency);
        const bookLink = f.bookUrl
          ? `<a href="${f.bookUrl}" target="_blank" rel="noopener noreferrer">Book</a>`
          : '';

        row.innerHTML = `
          <td>${f.flightNumber || ''}</td>
          <td>${f.origin || ''}</td>
          <td>${f.destination || ''}</td>
          <td>${dep}</td>
          <td>${arr}</td>
          <td>${priceText}</td>
          <td>${bookLink}</td>
        `;
        tbody.appendChild(row);
      });

      if (!flights.length) {
        statusEl.textContent = 'No flights found.';
      }
    } catch (err) {
      console.error('Error loading flight data:', err);
      statusEl.textContent = 'Failed to load flight data';
    }
  }

  document.addEventListener('DOMContentLoaded', loadFlightData);
</script>

</body>
</html>
